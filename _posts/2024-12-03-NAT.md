---
title: "NAT(Network Address Translation)"
date: 2024-12-03
categories: knowledge
tags:
  - network
  - study
---

이번 주 스터디 주제는 바로 **NAT(Network Address Translation)**이다. NAT에 대해서는 내부 IP와 외부 IP를 서로 변환한다는 개념만 알고 있었는데, 이번에 ChatGPT를 통해 정리해본다.

<br>

# NAT 란?

<img src="{{ site.url }}{{ site.baseurl }}/assets/images/2024/1203/241203_01.svg" width="100%"/>
출처: [wikipedia](https://en.wikipedia.org/wiki/Network_address_translation){:target="_blank"}
<br><br>

**NAT(Network Address Translation)**는 네트워크 주소 변환을 의미하며, 컴퓨터 네트워크에서 **내부 네트워크의 IP 주소를 외부 네트워크의 IP 주소로 변환하거나 그 반대로 변환**하는 기술이다. NAT는 주로 **IPv4 주소의 부족 문제를 해결**하거나 **보안**과 **네트워크 관리**를 목적으로 사용된다.

## 내부 네트워크 (Private Network)

- 내부 네트워크는 사설 IP 주소를 사용하는 네트워크로, 가정이나 기업의 로컬 환경에서 사용된다.
- 사설 IP 주소는 인터넷에서 직접적으로 사용될 수 없으며, NAT를 통해 공인 IP 주소로 변환되어야 인터넷과 연결될 수 있다.
- 주요 사설 IP 주소 범위:
  - `10.0.0.0 ~ 10.255.255.255` (A 클래스)
  - `172.16.0.0 ~ 172.31.255.255` (B 클래스)
  - `192.168.0.0 ~ 192.168.255.255` (C 클래스)
- 예시: 가정용 공유기에서 흔히 사용하는 `192.168.0.1`.

## 외부 네트워크 (Public Network)

- 외부 네트워크는 인터넷 서비스 제공업체(ISP)로부터 할당받은 공인 IP 주소를 사용한다.
- 공인 IP 주소는 전 세계적으로 고유하며, 인터넷 상의 모든 장치가 통신할 때 사용된다.
- NAT는 내부 네트워크의 여러 장치가 공인 IP 주소 하나를 공유하면서 인터넷과 연결될 수 있도록 지원한다.

<br>

# NAT의 동작 원리

NAT는 **라우터**나 **게이트웨이** 장치에서 실행되며, 내부와 외부 네트워크 간의 IP 주소 변환을 처리한다. 동작 방식은 다음과 같다:

## 내부 네트워크에서 외부 네트워크로의 요청

1. 내부 네트워크의 장치(A)가 웹 서버(B)에 요청을 보낸다고 가정하자.
2. 장치 A의 사설 IP 주소와 포트 번호는 NAT 장치에서 공인 IP 주소로 변환된다.
   - 예: `192.168.0.2:12345 → 203.0.113.1:54321`.
3. 요청은 변환된 공인 IP 주소를 사용해 외부 네트워크로 전달된다.

## 외부 네트워크에서 내부 네트워크로의 응답

1. 외부의 웹 서버(B)가 NAT 장치의 공인 IP 주소로 응답을 보낸다.
2. NAT 장치는 해당 공인 IP 주소와 포트 번호를 기반으로 원래 요청을 보낸 내부 장치(A)를 식별한다.
3. 응답 패킷의 공인 IP 주소를 내부 네트워크의 사설 IP 주소로 변환하여 A에게 전달한다.

- 예: `203.0.113.1:54321 → 192.168.0.2:12345`.

## NAT의 동작 과정 요약

1. 패킷이 라우터를 통과할 때, 헤더의 **소스 IP 주소** 또는 **목적지 IP 주소**를 변환한다.
2. 변환된 IP 주소와 매핑 정보를 NAT 테이블에 기록하여 추적한다.
3. 외부 네트워크에서 받은 패킷은 NAT 테이블을 참조하여 올바른 내부 장치로 전달한다.

## 예시 시나리오

- **가정 내 여러 기기 연결**
  1. 가정 내 스마트폰(192.168.0.2)과 PC(192.168.0.3)가 각각 유튜브에 접속한다고 가정하자.
  2. 공유기(NAT 장치)는 스마트폰과 PC의 사설 IP 주소를 `203.0.113.1`이라는 공인 IP 주소로 변환하고, 각 장치에 고유한 포트를 할당한다.
     - 스마트폰 요청: `192.168.0.2:12345 → 203.0.113.1:5000`.
     - PC 요청: `192.168.0.3:54321 → 203.0.113.1:5001`.
  3. NAT는 이러한 매핑 정보를 유지하며, 외부 응답이 올 때 각각 올바른 내부 장치로 전달되도록 한다.

<br>

# NAT의 유형

- **Static NAT**: 고정 매핑, 특정 장치에 외부 접근 필요 시 사용.
- **Dynamic NAT**: 동적 매핑, 공인 IP 주소를 효율적으로 사용.
- **PAT/NAT Overloading**: 공인 IP 주소 절약, 포트 번호로 다수의 연결 지원.
- **NAT64**: IPv4와 IPv6 간 통신 지원.

## Static NAT (정적 NAT)

- **설명**:
  - 하나의 사설 IP 주소를 하나의 공인 IP 주소와 1:1로 매핑하는 방식.
  - 변환 테이블이 고정되어 있으며, 매핑이 변경되지 않는다.
- **특징**:
  - 고정된 IP 매핑으로 특정 내부 장치에 외부에서 쉽게 접근 가능.
  - 공인 IP 주소를 많이 소모.
- **예시**:
  - 내부 서버(예: 웹 서버, 이메일 서버)에 외부에서 직접 접근해야 하는 경우.

## Dynamic NAT (동적 NAT)

- **설명**:
  - 내부 네트워크의 사설 IP 주소를 공인 IP 주소 풀에서 동적으로 할당.
  - 요청이 들어올 때마다 공인 IP 주소가 자동으로 매핑된다.
- **특징**:
  - 공인 IP 주소를 효율적으로 사용할 수 있음.
  - 특정 장치에 대한 외부 접근은 어렵다.
- **예시**:
  - 사설 네트워크의 여러 장치가 임시로 공인 IP 주소를 필요로 할 때.

## PAT (Port Address Translation) / NAT Overloading

- **설명**:
  - 하나의 공인 IP 주소를 여러 사설 IP 주소와 공유하며, **포트 번호**를 통해 구분.
  - 공인 IP 주소가 부족한 환경에서 가장 많이 사용되는 방식.
- **특징**:
  - 포트 번호를 통해 각 장치를 식별하므로 공인 IP 주소 하나로 많은 장치가 인터넷에 연결 가능.
  - 포트 충돌 가능성이 있으나, 매우 드문 경우.
- **예시**:
  - 가정용 공유기에서 내부 네트워크의 모든 장치가 공인 IP 주소 하나를 통해 인터넷을 사용하는 경우.
  - 예:
    - `192.168.0.2:12345 → 203.0.113.1:54321`.
    - `192.168.0.3:67890 → 203.0.113.1:54322`.

## NAT64

- **설명**:
  - IPv6와 IPv4 간의 통신을 지원하기 위해 사용되는 방식.
  - IPv6 주소를 IPv4 주소로 변환하거나 그 반대로 변환한다.
- **특징**:
  - IPv6 전환 과정에서 IPv4와의 호환성을 유지하기 위해 필수적인 역할.
  - IPv6 전용 네트워크가 IPv4 리소스에 접근할 때 주로 사용.
- **예시**:
  - IPv6 기반의 클라이언트가 IPv4 기반의 서버에 연결할 때.

<br>

# NAT의 장점

- **효율성**: IPv4 주소를 절약하고, 다중 장치를 지원.
- **보안**: 내부 네트워크 IP 숨김으로 기본적인 방어 제공.
- **유연성**: 내부 네트워크 구성 변경과 외부 네트워크 간의 독립성 유지.
- **확장성**: IPv4와 IPv6 간의 호환성 제공.

## IPv4 주소 부족 문제 해결

- NAT는 사설 네트워크의 여러 장치가 공인 IP 주소 하나 또는 소수의 공인 IP 주소를 공유할 수 있게 해준다.
- 이로 인해 공인 IP 주소의 소모를 줄이고, IPv4 주소 부족 문제를 완화한다.
- 예시: 사설 네트워크에 100개의 장치가 연결되어 있어도, NAT를 사용하면 공인 IP 주소 1개만으로 외부 인터넷과 통신할 수 있다.

## 보안 강화

- NAT는 내부 네트워크의 사설 IP 주소를 숨기므로 외부에서 내부 네트워크 장치를 직접적으로 탐지하거나 접근하기 어렵다.
- 공격자가 내부 네트워크의 IP 정보를 알 수 없기 때문에 기본적인 보안 장치를 제공한다.
- 예시: 외부 해커가 공인 IP 주소만 확인할 수 있으며, 내부 장치의 사설 IP 주소에는 접근할 수 없다.

## 내부 네트워크 유연성 제공

- NAT를 통해 내부 네트워크의 IP 주소 체계를 자유롭게 설정할 수 있다. 내부 네트워크 구조를 변경해도 외부 네트워크와의 통신에는 영향을 미치지 않는다.
- 예시: 기업 네트워크에서 내부 IP 주소 체계를 변경해도 NAT 장치의 설정만 유지하면 외부 인터넷 연결에는 문제가 없다.

## 단일 공인 IP 주소로 다중 장치 지원

- NAT는 포트 번호를 사용해 다수의 장치가 하나의 공인 IP 주소를 공유하도록 허용한다(PAT 방식).
- 예시: 가정용 공유기에서 스마트폰, 노트북, 태블릿이 하나의 공인 IP 주소를 사용해 동시에 인터넷에 연결.

## 네트워크 트래픽 관리

- NAT는 트래픽을 변환하고 라우팅하면서 NAT 테이블을 관리하므로, 네트워크 트래픽 흐름을 추적하고 제어할 수 있는 기회를 제공한다.
- 예시: NAT 테이블에서 특정 내부 장치가 생성한 트래픽을 추적하여 관리자가 네트워크 사용량을 분석할 수 있다.

## IPv4와 IPv6 간의 호환 지원

- NAT64와 같은 변형된 NAT 방식을 통해 IPv6 네트워크와 IPv4 네트워크 간의 통신이 가능하다.
- IPv4에서 IPv6로 전환하는 과정에서 NAT는 호환성을 제공한다.
- 예시: IPv6 전용 장치가 NAT64를 통해 IPv4 서버와 통신.

## 외부 IP 주소 변경의 용이성

- 공인 IP 주소를 변경하더라도 내부 네트워크에 있는 장치들의 설정에는 영향을 미치지 않는다.
- 예시: ISP로부터 새로운 공인 IP 주소를 할당받더라도, NAT 설정만 업데이트하면 내부 네트워크의 장치들은 그대로 사용 가능.

<br>

# NAT의 단점

- **연결성 문제**: 엔드투엔드 통신에 어려움.
- **성능 제약**: NAT 변환으로 인해 네트워크 성능 저하.
- **제한된 자원**: 포트 고갈 및 프로토콜 호환성 문제.
- **추적 어려움**: 내부 장치의 트래픽 식별이 어려움.
- **보안 한계**: 보안 강화 기능은 아님.

## **엔드투엔드 연결 문제**
  - NAT는 내부 네트워크의 사설 IP 주소를 숨기고 공인 IP 주소로 변환하므로, 외부 네트워크에서 내부 네트워크의 장치와 직접적으로 통신하는 데 어려움이 있다.
  - 특히, P2P, VoIP, 온라인 게임과 같이 엔드투엔드 연결이 필요한 애플리케이션에서 문제가 발생할 수 있다.
  - 예시: 화상 회의 솔루션(예: Zoom, Skype)에서 양방향 통신을 설정하는 데 NAT Traversal 기술(예: STUN, TURN)이 필요.

## **네트워크 성능 저하**
  - NAT 장치는 IP 주소와 포트를 변환하며 NAT 테이블을 유지 관리해야 한다. 이 과정에서 추가적인 계산이 필요하여 라우터의 성능이 저하될 수 있다.
  - 예시: 대규모 네트워크에서 NAT를 처리하는 장치가 과부하에 걸려 트래픽 속도가 느려지거나 패킷이 드롭될 가능성.

## **포트 고갈 문제**
  - PAT 방식의 NAT는 하나의 공인 IP 주소에 다수의 내부 장치를 연결하기 위해 포트를 사용한다. 그러나 포트 번호는 65535개로 제한되므로, 대규모 트래픽을 처리할 때 포트가 고갈될 수 있다.
  - 예시: 많은 클라이언트가 NAT 장치를 통해 동시에 인터넷에 접속하려고 할 때, 포트 번호 부족으로 인해 새로운 연결이 차단될 수 있음.

## **프로토콜 제약**
  - 일부 프로토콜(예: IPsec, FTP, SIP)은 NAT 환경에서 정상적으로 작동하지 않거나 추가 설정이 필요하다.
  - 특히, 패킷에 IP 주소 정보를 포함하는 프로토콜은 NAT 변환으로 인해 정보가 손상될 수 있다.
  - 예시: FTP의 Active 모드에서 데이터 채널이 NAT를 통과하지 못하는 문제.

## **추적 및 디버깅의 어려움**
  - NAT는 내부 네트워크의 트래픽을 공인 IP 주소 하나로 변환하므로, 어떤 내부 장치가 특정 요청을 보냈는지 식별하기 어렵다.
  - 예시: 네트워크 관리자가 NAT 뒤의 특정 장치에서 발생한 문제를 추적하려고 할 때, NAT 테이블 정보를 의존해야 함.

## **보안 오해 가능성**
  - NAT는 내부 네트워크의 IP 주소를 숨기므로 보안을 강화하는 것처럼 보이지만, 실제로는 보안 기능이 아니라 주소 변환 기능에 불과하다.
  - NAT는 방화벽처럼 액세스 제어를 수행하지 않으며, 추가적인 보안 설정이 필요하다.
  - 예시: NAT 장치만으로는 내부 네트워크로 들어오는 악의적인 트래픽을 차단할 수 없음.

## **IPv6로의 전환 방해**
  - NAT는 IPv4 주소 부족 문제를 완화하지만, 이것이 오히려 IPv6로 전환하려는 동기를 약화시킨다.
  - IPv6의 엔드투엔드 연결성을 방해할 수 있다.
  - 예시: IPv6 도입이 가능한 환경에서도 기존의 NAT 기반 IPv4 환경을 유지하려는 경향.

<br>

# NAT Traversal

NAT Traversal(NAT 통과)은 NAT(Network Address Translation) 환경에서 내부 네트워크의 장치와 외부 네트워크의 장치가 원활하게 통신할 수 있도록 하는 기술이다. NAT는 기본적으로 내부 IP 주소를 숨기기 때문에, 외부에서 직접 연결이 어렵다. NAT Traversal은 이러한 문제를 해결하기 위해 고안된 방법이다.

- NAT Traversal은 NAT 환경에서 내부 장치와 외부 장치 간의 통신 문제를 해결하기 위한 기술.
- STUN, TURN, UPnP, NAT-PMP/PCP와 같은 기술이 주로 사용.
- VoIP, P2P, 온라인 게임, VPN 등 다양한 네트워크 애플리케이션에서 필수적으로 활용.

## **NAT Traversal이 필요한 이유**
1. **엔드투엔드 연결 문제**:
   - NAT는 내부 네트워크의 사설 IP 주소를 숨기기 때문에 외부 장치가 내부 장치와 직접 통신할 수 없다.
   - 예: VoIP, P2P 네트워크, 온라인 게임 등은 양방향 연결이 필요한데 NAT 환경에서는 제약이 발생.

2. **특정 프로토콜의 제한**:
   - NAT는 패킷의 IP 주소를 변경하기 때문에, IP 주소 정보를 포함하는 프로토콜(예: FTP, SIP)이 정상적으로 작동하지 않을 수 있다.

## **NAT Traversal 주요 기술**

### 1. **STUN (Session Traversal Utilities for NAT)**
- **설명**:
  - 클라이언트가 NAT 뒤에 있는 자신의 공인 IP 주소와 포트를 확인할 수 있도록 도와주는 프로토콜.
  - 외부 STUN 서버와 통신하여 NAT 매핑 정보를 얻는다.
- **장점**:
  - 간단하고 빠르며 대부분의 NAT 환경에서 작동.
- **단점**:
  - 대칭 NAT 환경에서는 작동하지 않을 수 있음.
- **사용 예**:
  - VoIP 애플리케이션(예: WebRTC)에서 자신의 공인 IP를 알아내기 위해 사용.

### 2. **TURN (Traversal Using Relays around NAT)**
- **설명**:
  - 클라이언트가 NAT 뒤에 있는 장치와 통신할 수 없을 경우, 릴레이 서버를 통해 데이터를 중계하는 방식.
  - 모든 트래픽이 TURN 서버를 경유.
- **장점**:
  - 모든 NAT 환경에서 작동.
- **단점**:
  - 릴레이 서버를 경유하기 때문에 대역폭과 비용이 증가.
- **사용 예**:
  - 화상 회의 솔루션에서 사용(예: Zoom, Microsoft Teams).

### 3. **UPnP (Universal Plug and Play)**
- **설명**:
  - NAT 장치가 자동으로 포트를 열어주는 방식.
  - 클라이언트가 NAT 라우터에 요청하여 포트 매핑을 설정한다.
- **장점**:
  - 설정이 간단하고 자동화 가능.
- **단점**:
  - 보안 취약점이 있을 수 있음.
- **사용 예**:
  - 가정용 공유기에서 P2P 애플리케이션(예: 토렌트).

### 4. **NAT-PMP/PCP (Port Mapping Protocol / Port Control Protocol)**
- **설명**:
  - 클라이언트가 NAT 라우터에 포트 매핑 요청을 보내, 외부와 통신할 수 있도록 설정.
  - NAT-PMP는 Apple에서 개발, PCP는 IETF 표준화.
- **장점**:
  - 효율적이고 설정이 간단.
- **단점**:
  - NAT 장치가 이 프로토콜을 지원해야 함.
- **사용 예**:
  - 홈 네트워크에서 IoT 장치가 외부 서버와 통신.

## **NAT Traversal의 동작 과정**
1. 클라이언트가 외부 서버(예: STUN/TURN)와 통신하여 자신의 공인 IP와 포트 정보를 확인.
2. 필요할 경우, 포트 매핑 요청(NAT-PMP/PCP)이나 릴레이 서버(TURN)를 통해 외부와의 통신 경로를 설정.
3. 설정된 경로를 통해 양방향 통신을 수행.

## **NAT Traversal 사용 사례**
1. **VoIP (Voice over IP)**:
   - NAT 뒤의 클라이언트가 통화 세션을 설정할 수 있도록 STUN/TURN 사용.
2. **P2P 네트워크**:
   - NAT 환경에서도 파일 공유 및 데이터 전송이 가능.
3. **온라인 게임**:
   - NAT 환경에서 실시간 다중 플레이어 연결을 지원.
4. **VPN (Virtual Private Network)**:
   - NAT 뒤의 장치가 VPN 서버에 연결할 수 있도록 터널링 설정.

<br>

# References.

[wikipedia](https://en.wikipedia.org/wiki/Network_address_translation){:target="\_blank"}<br>
[ChatGPT](https://chat.openai.com){:target="\_blank"}<br>
